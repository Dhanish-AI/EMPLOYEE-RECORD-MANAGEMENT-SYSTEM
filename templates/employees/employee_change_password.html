{% extends 'base.html' %}
{% block title %}Change Password | ERMS{% endblock %}
{% block content %}
<section class="dashboard narrow">
    <div class="card">
        <div class="card-header">
            <h2>Update Your Password</h2>
        </div>
        <p class="subtext">Choose a strong password with at least 8 characters, mixing letters, numbers, and symbols.</p>
        <form method="post" class="form-stacked" novalidate>
            {% csrf_token %}
            {% if form.errors %}
            <div class="alert alert-error">Please correct the highlighted fields and try again.</div>
            {% endif %}
            <div class="form-field">
                <label for="id_old_password">Current password</label>
                <div class="password-field" data-password-field>
                    {{ form.old_password }}
                    <button type="button" class="password-toggle" aria-label="Show password" data-password-toggle>
                        <span aria-hidden="true">üëÅÔ∏è</span>
                    </button>
                </div>
                {% if form.old_password.errors %}
                <span class="field-error">{{ form.old_password.errors|striptags }}</span>
                {% endif %}
            </div>
            <div class="form-field">
                <label for="id_new_password1">New password</label>
                <div class="password-field" data-password-field>
                    {{ form.new_password1 }}
                    <button type="button" class="password-toggle" aria-label="Show password" data-password-toggle>
                        <span aria-hidden="true">üëÅÔ∏è</span>
                    </button>
                </div>
                {% if form.new_password1.errors %}
                <span class="field-error">{{ form.new_password1.errors|striptags }}</span>
                {% endif %}
            </div>
            <div class="form-field">
                <label for="id_new_password2">Confirm new password</label>
                <div class="password-field" data-password-field>
                    {{ form.new_password2 }}
                    <button type="button" class="password-toggle" aria-label="Show password" data-password-toggle>
                        <span aria-hidden="true">üëÅÔ∏è</span>
                    </button>
                </div>
                {% if form.new_password2.errors %}
                <span class="field-error">{{ form.new_password2.errors|striptags }}</span>
                {% endif %}
            </div>
            <button type="submit" class="btn">Save Password</button>
            <a class="btn secondary" href="{% url 'employee_dashboard' %}">Cancel</a>
        </form>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
(function () {
  const passwordFields = document.querySelectorAll('[data-password-field]');

  passwordFields.forEach((wrapper) => {
    const input = wrapper.querySelector('input');
    const toggle = wrapper.querySelector('[data-password-toggle]');
    if (!input || !toggle) return;

    toggle.addEventListener('click', () => {
      const isHidden = input.type === 'password';
      input.type = isHidden ? 'text' : 'password';
      toggle.setAttribute('aria-label', isHidden ? 'Hide password' : 'Show password');
      toggle.classList.toggle('active', isHidden);
    });
  });
})();
</script>
{% endblock %}
